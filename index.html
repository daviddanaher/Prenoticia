<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barra Flotante con Panel Mi Cuenta (Reescrito)</title>
  <style>
    /* Reset y base */
    * { box-sizing: border-box; }
    html,body { margin:0; padding:0; height:100%; font-family: Arial, Helvetica, sans-serif; background:#fefefe; -webkit-font-smoothing:antialiased; }
    a { color: inherit; }

    /* ---------------------------
       BARRA FLOTANTE
       --------------------------- */
    .barra-flotante{
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background: #f68e03;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      user-select: none;
      overflow: visible;
    }

    /* En escritorio: quitar márgenes laterales (que pediste) */
    .barra-contenido{
      width: 100%;
      max-width: none; /* REMOVIDO: que no haya márgenes automáticos en escritorio */
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      height: 100%;
      padding-left: 0;  /* sin margen lateral en escritorio */
      padding-right: 0;
    }

    /* Grupos de la barra */
    .grupo-botones{
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      padding:0 8px;
      flex-shrink:0;
    }

    .btn{
      background:#bb6c00;
      color:#fff;
      border:none;
      padding:6px 10px;
      border-radius:4px;
      font-size:14px;
      cursor:pointer;
      height:32px;
      display:inline-flex;
      align-items:center;
      text-decoration:none;
      transition:background .22s ease;
      box-sizing:border-box;
      white-space:nowrap;
    }
    .btn:hover{ background:#a55a00; }

    /* SALUDO */
    #saludoUsuario{ color:white; display:flex; align-items:center; gap:8px; font-weight:700; padding:0 8px; }

    .foto-usuario{ width:32px; height:32px; border-radius:50%; object-fit:cover; display:inline-block; }

    /* ---------------------------
       POPUP LOGIN (input + botones + X)
       - queremos que sea un poco más largo adaptable en móvil y un poco más ancho en escritorio,
         pero no a todo el largo: definimos anchos responsivos con max-widths y porcentajes.
       --------------------------- */
    .popup-login{
      position:absolute;
      top:50px;
      left:50%;
      transform:translateX(-50%);
      display:none;
      align-items:center;
      gap:8px;
      padding:8px;
      background: #f68e03;
      border-radius:6px;
      z-index:10000;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      min-width: 260px;              /* ancho mínimo en escritorio */
      max-width: 440px;             /* no ocupa todo el largo */
      width: min(38vw, 420px);      /* adaptable: en pantallas grandes se hace un poco más ancho (no full) */
      box-sizing:border-box;
      overflow:visible;
      align-self:center;
    }

    .popup-login input[type="email"]{
      flex:1 1 auto;
      min-width: 180px;
      height:34px;
      padding:6px 8px;
      border-radius:4px;
      border: none;
      font-size:14px;
      outline: none;
      background: rgba(255,255,255,0.95);
      color:#111;
    }

    .popup-login .btn { height:34px; padding:6px 10px; }

    .popup-login .btn-cerrar{
      background:transparent;
      color:white;
      border:1px solid rgba(255,255,255,0.18);
      width:36px;
      height:36px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:6px;
      font-weight:700;
      padding:0;
    }
    .popup-login .btn-cerrar:hover{ background: rgba(255,255,255,0.06); }

    .mensaje-error{
      display:none;
      color:#fff;
      background: #d9534f;
      padding:6px 8px;
      border-radius:4px;
      font-size:13px;
    }

    /* ---------------------------
       PANEL "MI CUENTA"
       - el contenedor de acciones (botones Usuario/Contenido exclusivo/...) debe poder scrollear
         cuando su ancho total sea mayor que la pantalla (en móvil). EXCEPTO el contenido exclusivo,
         que NO debe scrollear (se muestra con flechas internas).
       --------------------------- */
    #panelMiCuenta{
      position:absolute;
      top:50px;
      left:0;
      right:0;
      display:none;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:8px;
      z-index:10000;
      background: transparent;
      user-select:none;
      width:100%;
    }

    #panelMiCuenta.visible{ display:flex; }

    .panel-inner{
      width:100%;
      display:flex;
      align-items:center;
      gap:12px;
      padding:0 8px;
      box-sizing:border-box;
    }

    /* ACCIONES (botones en fila) -> desplazable en X en móviles si son más largos que la pantalla */
    .acciones {
      display:flex;
      gap:8px;
      align-items:center;
      flex-shrink:0;
      overflow-x:auto;               /* permite scroll horizontal cuando excede */
      -webkit-overflow-scrolling: touch;
      padding-bottom:4px;
    }
    /* esconder scrollbar visual pero mantener scroll funcional */
    .acciones::-webkit-scrollbar{ height:6px; }
    .acciones::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.12); border-radius:3px; }

    .btn-panel{
      background:#bb6c00;
      color:#fff;
      border:none;
      padding:6px 12px;
      border-radius:6px;
      height:34px;
      display:inline-flex;
      align-items:center;
      cursor:pointer;
      white-space:nowrap;
      text-decoration:none !important;
    }
    .btn-panel:hover{ background:#a55a00; }

    /* CONTENEDOR EXCLUSIVO: NO deberia ser scrollable horizontalmente (queda con flechas internas) */
    .contenedor-exclusivo{
      display:flex;
      align-items:center;
      gap:8px;
      flex:1 1 auto;      /* ocupa el espacio restante */
      min-width:0;        /* permite que hijos se contraigan correctamente */
      overflow:visible;   /* importante: NO scrollea; su propio contenido controla su overflow */
    }

    .flecha{
      background: rgba(255,255,255,0.12);
      border: none;
      color: white;
      font-size:18px;
      cursor:pointer;
      padding:6px 8px;
      border-radius:6px;
      height:34px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:40px;
      box-sizing:border-box;
    }
    .flecha:hover{ background: rgba(255,255,255,0.25); }

    .articulo-exclusivo{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:6px;
      background: rgba(255,255,255,0.12);
      min-width:0;         /* para truncado interno si hace falta */
      max-width:100%;
      overflow:hidden;
      justify-content:flex-start;
    }
    .articulo-exclusivo .badge{
      background: rgba(255,255,255,0.18);
      color: white;
      font-weight:700;
      padding:4px 8px;
      border-radius:12px;
      font-size:12px;
      flex-shrink:0;
    }
    .articulo-exclusivo a{
      color:white;
      text-decoration:none;
      font-weight:600;
      font-size:14px;
      white-space:nowrap;
      text-overflow:ellipsis;
      overflow:hidden;
      display:inline-block;
      max-width: calc(100% - 120px); /* evita que ocupe todo el ancho */
    }
    .articulo-exclusivo a:hover{ text-decoration:underline; }

    /* BACK WRAPPER: botón volver alineado a la derecha si hay espacio */
    .back-wrapper{ margin-left:auto; display:flex; align-items:center; gap:8px; }

    /* USUARIO - detalle (nombre/apellido en negrita, resto no; mismos tamaños y alineados) */
    .usuario-detalle{
      display:flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
      color:white;
    }
    .usuario-texto{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }
    .usuario-nombre-apellido{ font-size:14px; line-height:1; display:inline-flex; gap:6px; align-items:center; }
    .usuario-nombre { font-weight:700; }    /* nombre en negrita */
    .usuario-apellido { font-weight:700; }  /* apellido en negrita */
    .usuario-otros { font-weight:400; font-size:14px; color: rgba(255,255,255,0.95); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

    /* Mensajes y estilos de adaptabilidad */
    @media (max-width:600px){
      /* Reducir 1px en los espacios laterales de la barra (pedido) */
      .barra-contenido{ padding-left:11px; padding-right:11px; }

      /* Popup login: más ancho proporcional en móvil (adaptable), pero no full width */
      .popup-login{
        left: 50%;
        transform: translateX(-50%);
        width: calc(85vw - 16px); /* ocupa más en móvil pero con margen */
        min-width: unset;
        max-width: 560px;
      }
      .popup-login input[type="email"]{ min-width: unset; width: 100%; }

      /* Botones más compactos en móvil */
      .btn{ font-size:13px; padding:5px 8px; height:30px; }
      .btn-panel{ padding:6px 10px; height:32px; font-size:13px; }

      /* acciones (botones) deben ser desplazables en X si exceden */
      .acciones{ overflow-x:auto; gap:6px; -webkit-overflow-scrolling:touch; padding-bottom:6px; }

      /* Contenedor exclusivo: seguir sin scrollear globalmente; mantenemos flechas táctiles más grandes */
      .flecha{ padding:8px 10px; min-width:44px; height:38px; border-radius:8px; }

      /* Articulo exclusivo: permitir que el título haga wrap si hace falta, pero seguir sin desplazar toda la barra */
      .articulo-exclusivo a{ white-space:normal; max-width:calc(100% - 64px); font-size:14px; }
      .articulo-exclusivo{ padding:8px 10px; border-radius:8px; }

      /* Usuario: mismo tamaño, pero más compacto */
      .usuario-nombre-apellido, .usuario-otros { font-size:13px; }
      #saludoUsuario { font-weight:700; font-size:13px; }
    }

    /* pequeña estética para scrollbars en panel */
    #panelMiCuenta::-webkit-scrollbar{ height:6px; }
    #panelMiCuenta::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.08); border-radius:3px; }

    /* Transiciones */
    .popup-login, #panelMiCuenta{ transition: transform .18s ease, opacity .18s ease; }

  </style>
</head>
<body>

  <!-- BARRA -->
  <div class="barra-flotante" role="banner" aria-label="Barra superior">
    <div class="barra-contenido" id="barraContenido">

      <!-- IZQUIERDA: Iniciar sesión / saludo -->
      <div class="grupo-botones" id="izquierda">
        <button class="btn" id="btnIniciarSesion" onclick="mostrarLogin()" aria-expanded="false" aria-controls="popupLogin">Iniciar sesión</button>
        <span id="saludoUsuario" aria-live="polite"></span>
      </div>

      <!-- CENTRO / CONTENEDOR PARA PANEL (cuando se abre se centra la UI) -->
      <div style="flex:1 1 auto; display:flex; justify-content:center; pointer-events:none;">
        <!-- espacio neutro (pointer-events:none evita interceptar clicks cuando el panel está oculto) -->
      </div>

      <!-- DERECHA: Suscribirme / Ayuda / otros botones (se reemplazan al loguear) -->
      <div class="grupo-botones" id="derecha" style="margin-right:8px;">
        <a class="btn" href="https://www.prenoticia.com/p/suscribirme-prenoticia.html" target="_blank" rel="noopener">Suscribirme</a>
        <a class="btn" href="https://www.prenoticia.com/mi-cuenta-ayuda" target="_blank" rel="noopener">Ayuda</a>
      </div>

      <!-- PANEL MI CUENTA (insertado debajo, mostrado por JS) -->
      <div id="panelMiCuenta" aria-hidden="true"></div>

      <!-- POPUP LOGIN (input + Ingresar + X) -->
      <div class="popup-login" id="popupLogin" role="dialog" aria-modal="true" aria-labelledby="labelLogin">
        <input id="inputEmail" type="email" placeholder="Tu correo" aria-label="Correo electrónico" />
        <button class="btn" onclick="validarEmail()" aria-label="Ingresar">Ingresar</button>
        <button class="btn btn-cerrar" onclick="cerrarLogin()" aria-label="Cerrar sesión">✕</button>
        <span class="mensaje-error" id="mensajeError" role="status" aria-live="assertive"></span>
      </div>

    </div>
  </div>

  <script>
    /************************************************************
     * Datos de ejemplo (mantengo la estructura que traías)
     ************************************************************/
    const usuarios = {
      "mauricioacostacom@gmail.com": {
        activo: true,
        nombre: "Mauricio David",
        apellido: "Acosta Danaher",
        email: "mauricioacostacom@gmail.com",
        medioPago: "Mercado Pago",
        ultimoPago: "31 de julio de 2025",
        proximoPago: "31 de septiembre de 2025",
        pais: "Buenos Aires, Argentina",
        emailVerificado: true,
        foto: "https://pbs.twimg.com/profile_images/1907511710769930240/7oUtDTMv_400x400.jpg",
        articulos: [
          { titulo: "Submarino desaparece en la Antártida tras descubrir estructuras desconocidas", url: "https://www.prenoticia.com/2025/08/submarino-desaparece-en-la-antartida.html" },
          { titulo: "Un informe reciente señala que no hace falta caminar tantos pasos como se creía para cuidar la salud", url: "https://www.prenoticia.com/2025/08/un-informe-reciente-senala-que-no-hace.html" },
          { titulo: "El cerebro del hombre es más grande, pero el de la mujer funciona con más eficiencia", url: "https://www.prenoticia.com/2025/06/el-cerebro-del-hombre-es-mas-grande.html" },
          { titulo: "¡Ganá una suscripción anual! Participá del sorteo exclusivo", url: "https://www.prenoticia.com/sorteo-2025", tipo: "sorteo" },
          { titulo: "Código exclusivo: 10% de descuento en Prenoticia", url: "https://www.prenoticia.com/codigo-descuento", tipo: "codigo" }
        ]
      },
      "luciacarpio20@gmail.com": {
        activo: false,
        nombre: "Maria",
        apellido: "Carpio Peralta",
        email: "luciacarpio20@gmail.com",
        deuda: "$1.000",
        foto: ""
      }
    };

    /* Estado */
    let panelEstado = "cerrado";
    let usuarioActual = null;
    let articuloIndex = 0;

    /* Elementos */
    const btnIniciarSesion = document.getElementById("btnIniciarSesion");
    const saludoUsuario = document.getElementById("saludoUsuario");
    const popupLogin = document.getElementById("popupLogin");
    const mensajeError = document.getElementById("mensajeError");
    const inputEmail = document.getElementById("inputEmail");
    const panelMiCuenta = document.getElementById("panelMiCuenta");
    const derecha = document.getElementById("derecha");
    const izquierda = document.getElementById("izquierda");

    /* Mostrar / ocultar login */
    function mostrarLogin(){
      mensajeError.style.display = "none";
      popupLogin.style.display = "flex";
      popupLogin.setAttribute("aria-hidden","false");
      btnIniciarSesion.setAttribute("aria-expanded","true");
      setTimeout(()=> inputEmail.focus(), 50);
    }
    function cerrarLogin(){
      popupLogin.style.display = "none";
      popupLogin.setAttribute("aria-hidden","true");
      btnIniciarSesion.setAttribute("aria-expanded","false");
      inputEmail.value = "";
      mensajeError.style.display = "none";
    }

    /* Validación simple contra objeto usuarios (demo) */
    function validarEmail(){
      const email = (inputEmail.value || "").trim().toLowerCase();
      if(!email){ mensajeError.textContent = "Por favor, ingresá tu correo electrónico"; mensajeError.style.display = "inline-block"; return; }
      if(usuarios[email]){
        if(usuarios[email].activo){
          localStorage.setItem("usuarioLogueado", email);
          cargarSesion(usuarios[email]);
          cerrarLogin();
        } else {
          mensajeError.textContent = `Tu cuenta registra una deuda impaga de ${usuarios[email].deuda}.`;
          mensajeError.style.display = "inline-block";
        }
      } else {
        mensajeError.textContent = "El correo ingresado no está suscripto.";
        mensajeError.style.display = "inline-block";
      }
    }

    /* Cargar sesión: ajustar UI */
    function cargarSesion(usuario){
      usuarioActual = usuario;
      btnIniciarSesion.style.display = "none";
      saludoUsuario.innerHTML = ""; // limpiar

      if(usuario.foto){
        const img = document.createElement("img"); img.src = usuario.foto; img.className = "foto-usuario"; img.alt = usuario.nombre || "Usuario";
        saludoUsuario.appendChild(img);
      }
      // Mostrar primer nombre
      const primerNombre = (usuario.nombre || "").split(" ")[0] || usuario.nombre || "";
      const textNode = document.createTextNode(primerNombre);
      saludoUsuario.appendChild(textNode);

      // reemplazar bloque derecho por botones de cuenta y cerrar sesión
      derecha.innerHTML = "";

      const btnCuenta = document.createElement("button");
      btnCuenta.className = "btn";
      btnCuenta.textContent = "Mi cuenta";
      btnCuenta.onclick = () => { if(panelEstado === "cerrado") mostrarPanelInicio(); else ocultarPanel(); };
      derecha.appendChild(btnCuenta);

      const btnCerrarSesion = document.createElement("button");
      btnCerrarSesion.className = "btn";
      btnCerrarSesion.textContent = "Cerrar sesión";
      btnCerrarSesion.onclick = () => { localStorage.removeItem("usuarioLogueado"); location.reload(); };
      derecha.appendChild(btnCerrarSesion);

      ocultarPanel();
    }

    /* Mostrar panel inicial con botones (acciones) */
    function mostrarPanelInicio(){
      panelEstado = "inicio";
      construirPanelInicio();
      // esconder las zonas laterales para dar foco al panel (simula comportamiento previo)
      izquierda.style.display = "none";
      derecha.style.display = "none";
      panelMiCuenta.style.display = "flex";
      panelMiCuenta.setAttribute("aria-hidden","false");
      panelMiCuenta.classList.add("visible");
    }

    function ocultarPanel(){
      panelMiCuenta.classList.remove("visible");
      panelMiCuenta.style.display = "none";
      panelMiCuenta.innerHTML = "";
      panelMiCuenta.setAttribute("aria-hidden","true");
      panelEstado = "cerrado";
      izquierda.style.display = "flex";
      derecha.style.display = "flex";
    }

    /* Construir panel inicio (acciones desplazables si exceden ancho) */
    function construirPanelInicio(){
      panelMiCuenta.innerHTML = "";

      const inner = document.createElement("div");
      inner.className = "panel-inner";

      // acciones: al ser muchas se pueden scrollear horizontalmente en móvil
      const acciones = document.createElement("div");
      acciones.className = "acciones";
      acciones.setAttribute("role","toolbar");
      acciones.setAttribute("aria-label","Acciones de mi cuenta");

      const crearBoton = (texto, handler, esEnlace=false, href)=>{
        if(esEnlace){
          const a = document.createElement("a");
          a.className = "btn-panel";
          a.textContent = texto;
          a.href = href || "#";
          a.target = "_blank";
          a.rel = "noopener";
          return a;
        } else {
          const b = document.createElement("button");
          b.className = "btn-panel";
          b.textContent = texto;
          b.onclick = handler;
          return b;
        }
      };

      acciones.appendChild(crearBoton("Usuario", ()=> construirDetalle("nombre")));
      acciones.appendChild(crearBoton("Contenido exclusivo", ()=> construirExclusivo()));
      acciones.appendChild(crearBoton("Método de pago", ()=> construirDetalle("metodoPago")));
      acciones.appendChild(crearBoton("Próximas fechas de pago", ()=> construirDetalle("proximosPagos")));
      acciones.appendChild(crearBoton("Dar de baja suscripción", null, true, "https://www.prenoticia.com/baja-suscripción"));
      acciones.appendChild(crearBoton("Ayuda", null, true, "https://www.prenoticia.com/mi-cuenta-ayuda"));

      inner.appendChild(acciones);

      // back wrapper (botón volver situado a la derecha)
      const backWrap = document.createElement("div");
      backWrap.className = "back-wrapper";
      inner.appendChild(backWrap);

      panelMiCuenta.appendChild(inner);

      construirBotonVolverInContainer(backWrap);
    }

    /* Contenido exclusivo (con flechas internas). Importante: ESTE BLOQUE NO debe scrollear horizontalmente
       con el resto de las acciones; por eso lo implementamos dentro de su propio contenedor con flechas. */
    function construirExclusivo(){
      panelEstado = "detalle";
      panelMiCuenta.innerHTML = "";

      if(!usuarioActual || !usuarioActual.articulos || !usuarioActual.articulos.length){
        panelMiCuenta.textContent = "No hay contenido exclusivo disponible.";
        construirBotonVolver();
        return;
      }

      const inner = document.createElement("div");
      inner.className = "panel-inner";

      const cont = document.createElement("div");
      cont.className = "contenedor-exclusivo";

      // Flechas y artículo (interno)
      const flechaIzq = document.createElement("button");
      flechaIzq.className = "flecha";
      flechaIzq.textContent = "<";
      flechaIzq.setAttribute("aria-label","Anterior artículo");
      flechaIzq.onclick = () => { articuloIndex = (articuloIndex - 1 + usuarioActual.articulos.length) % usuarioActual.articulos.length; mostrarArticulo(); };

      const flechaDer = document.createElement("button");
      flechaDer.className = "flecha";
      flechaDer.textContent = ">";
      flechaDer.setAttribute("aria-label","Siguiente artículo");
      flechaDer.onclick = () => { articuloIndex = (articuloIndex + 1) % usuarioActual.articulos.length; mostrarArticulo(); };

      const articuloDiv = document.createElement("div");
      articuloDiv.className = "articulo-exclusivo";

      const badge = document.createElement("span"); badge.className = "badge";
      const enlace = document.createElement("a"); enlace.target = "_blank"; enlace.rel = "noopener";

      articuloDiv.appendChild(badge);
      articuloDiv.appendChild(enlace);

      cont.appendChild(flechaIzq);
      cont.appendChild(flechaDer);
      cont.appendChild(articuloDiv);

      inner.appendChild(cont);

      const backWrap = document.createElement("div");
      backWrap.className = "back-wrapper";
      inner.appendChild(backWrap);

      panelMiCuenta.appendChild(inner);

      construirBotonVolverInContainer(backWrap);

      function mostrarArticulo(){
        const art = usuarioActual.articulos[articuloIndex];
        enlace.href = art.url || "#";
        enlace.textContent = art.titulo || "Artículo";
        if(art.tipo === "sorteo") badge.textContent = "SORTEO";
        else if(art.tipo === "codigo") badge.textContent = "CÓDIGO";
        else if(art.tipo === "exclusivo") badge.textContent = "EXCLUSIVO";
        else badge.textContent = "";
        badge.style.display = badge.textContent ? "inline-flex" : "none";
      }

      mostrarArticulo();
    }

    /* Construir detalle de usuario (nombre & apellido en negrita; resto no; mismos tamaños y alineados) */
    function construirDetalle(tipo){
      panelEstado = "detalle";
      panelMiCuenta.innerHTML = "";
      if(!usuarioActual) return;

      const inner = document.createElement("div");
      inner.className = "panel-inner";

      const contenido = document.createElement("div");
      contenido.style.display = "flex";
      contenido.style.alignItems = "center";
      contenido.style.gap = "12px";
      contenido.style.minWidth = "0";

      if(tipo === "nombre"){
        const contUsuario = document.createElement("div");
        contUsuario.className = "usuario-detalle";

        if(usuarioActual.foto){
          const img = document.createElement("img"); img.src = usuarioActual.foto; img.className = "foto-usuario"; img.alt = (usuarioActual.nombre || "") + " foto";
          contUsuario.appendChild(img);
        }

        // texto: nombre y apellido en negrita (separados), resto en peso normal; todos con mismo tamaño
        const texto = document.createElement("div");
        texto.className = "usuario-texto";

        const lineaNombre = document.createElement("div");
        lineaNombre.className = "usuario-nombre-apellido";
        const spanNombre = document.createElement("span"); spanNombre.className = "usuario-nombre"; spanNombre.textContent = usuarioActual.nombre || "";
        const spanApellido = document.createElement("span"); spanApellido.className = "usuario-apellido"; spanApellido.textContent = usuarioActual.apellido || "";
        lineaNombre.appendChild(spanNombre);
        lineaNombre.appendChild(spanApellido);

        const lineaOtros = document.createElement("div");
        lineaOtros.className = "usuario-otros";
        const emailSpan = document.createElement("span"); emailSpan.textContent = usuarioActual.email || "";
        const verificadoSpan = document.createElement("span"); verificadoSpan.style.marginLeft = "8px";
        verificadoSpan.textContent = usuarioActual.emailVerificado ? "✅ Email verificado" : "❌ Email no verificado";
        const paisSpan = document.createElement("span"); paisSpan.style.marginLeft = "8px"; paisSpan.textContent = usuarioActual.pais || "";

        // todo con el mismo tamaño: 14px (CSS ya lo gestiona)
        lineaOtros.appendChild(emailSpan);
        lineaOtros.appendChild(verificadoSpan);
        lineaOtros.appendChild(paisSpan);

        texto.appendChild(lineaNombre);
        texto.appendChild(lineaOtros);
        contUsuario.appendChild(texto);
        contenido.appendChild(contUsuario);
      }

      if(tipo === "metodoPago"){
        const texto = document.createElement("div");
        texto.className = "usuario-otros";
        texto.textContent = `Método de pago: ${usuarioActual.medioPago || "No especificado"}`;
        contenido.appendChild(texto);
      }

      if(tipo === "proximosPagos"){
        const texto = document.createElement("div");
        texto.className = "usuario-otros";
        texto.innerHTML = `Último pago: <strong>${usuarioActual.ultimoPago || "No disponible"}</strong> &nbsp; Próximo pago: <strong>${usuarioActual.proximoPago || "No disponible"}</strong>`;
        contenido.appendChild(texto);
      }

      inner.appendChild(contenido);

      const backWrap = document.createElement("div");
      backWrap.className = "back-wrapper";
      inner.appendChild(backWrap);

      panelMiCuenta.appendChild(inner);

      construirBotonVolverInContainer(backWrap);
    }

    /* Botón volver que se inserta dentro de un contenedor dado (back-wrapper) */
    function construirBotonVolverInContainer(container){
      container.innerHTML = "";
      const btnVolver = document.createElement("button");
      btnVolver.className = "btn-panel";
      btnVolver.textContent = "← Volver";
      btnVolver.onclick = () => {
        if(panelEstado === "detalle") mostrarPanelInicio();
        else ocultarPanel();
      };
      container.appendChild(btnVolver);
    }

    /* Versión simple de construirBotonVolver para compatibilidad */
    function construirBotonVolver(){
      const btnVolver = document.createElement("button");
      btnVolver.className = "btn-panel";
      btnVolver.textContent = "← Volver";
      btnVolver.style.marginLeft = "10px";
      btnVolver.onclick = () => {
        if(panelEstado === "detalle") mostrarPanelInicio();
        else ocultarPanel();
      };
      panelMiCuenta.appendChild(btnVolver);
    }

    /* Cargar sesión si había un usuario guardado */
    window.onload = () => {
      const emailGuardado = localStorage.getItem("usuarioLogueado");
      if(emailGuardado && usuarios[emailGuardado] && usuarios[emailGuardado].activo){
        cargarSesion(usuarios[emailGuardado]);
      }
    };

    /* Cerrar panel al hacer click fuera (mejora de usabilidad) */
    document.addEventListener("click", function(e){
      const popup = document.getElementById("popupLogin");
      const panel = document.getElementById("panelMiCuenta");
      const dentroPopup = popup && popup.contains(e.target);
      const dentroPanel = panel && panel.contains(e.target);
      const esBoton = btnIniciarSesion && btnIniciarSesion.contains(e.target);
      if(!dentroPopup && !esBoton){
        // no cerrar automáticamente por si el usuario está escribiendo, sólo ocultamos si está visible y clicka fuera
        if(popup && popup.style.display === "flex") cerrarLogin();
      }
      // Si panel está abierto y se hace click fuera del panel, lo cerramos
      if(panel && panel.classList.contains("visible") && !dentroPanel){
        ocultarPanel();
      }
    });

    /* Evitar que scroll horizontal del body afecte a las acciones al arrastrar en móvil */
    (function(){
      const accionesContainer = document.createElement('div');
      // no-op; la propia CSS de .acciones ya gestiona -webkit-overflow-scrolling
    })();

  </script>

</body>
</html>
